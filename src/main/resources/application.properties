# =============================================================================
# STOCKIFY APPLICATION CONFIGURATION
# Production Environment Configuration
# =============================================================================

# Application Settings
spring.application.name=Stockify
spring.profiles.active=prod
server.port=8080

# Database Configuration - PostgreSQL Production
spring.datasource.url=${POSTGRES_URL:jdbc:postgresql://localhost:5432/stockify}
spring.datasource.username=${POSTGRES_USER:postgres}
spring.datasource.password=${POSTGRES_PASSWORD:postgres}
spring.datasource.driver-class-name=org.postgresql.Driver
spring.datasource.ddl-auto=drop-create


# Database Connection Pool Configuration
spring.datasource.hikari.maximum-pool-size=${DB_POOL_SIZE:10}
spring.datasource.hikari.minimum-idle=${DB_POOL_MIN_IDLE:2}
spring.datasource.hikari.connection-timeout=${DB_CONNECTION_TIMEOUT:30000}
spring.datasource.hikari.idle-timeout=${DB_IDLE_TIMEOUT:600000}
spring.datasource.hikari.max-lifetime=${DB_MAX_LIFETIME:1800000}
spring.datasource.hikari.leak-detection-threshold=${DB_LEAK_DETECTION:60000}
spring.datasource.hikari.validation-timeout=${DB_VALIDATION_TIMEOUT:3000}
spring.datasource.hikari.initialization-fail-timeout=${DB_INIT_FAIL_TIMEOUT:30000}
spring.datasource.hikari.connection-test-query=SELECT 1
spring.datasource.hikari.register-mbeans=true
spring.datasource.hikari.auto-commit=false

# JPA/Hibernate Configuration - Production PostgreSQL
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.PostgreSQLDialect
spring.jpa.hibernate.ddl-auto=validate
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.format_sql=false
spring.jpa.properties.hibernate.jdbc.batch_size=50
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true
spring.jpa.properties.hibernate.jdbc.lob.non_contextual_creation=true

# Multi-tenancy Configuration - PostgreSQL
spring.jpa.properties.hibernate.multiTenancy=SCHEMA
spring.jpa.properties.hibernate.tenant_identifier_resolver=dev.oasis.stockify.config.tenant.CurrentTenantIdentifierResolverImpl
spring.jpa.properties.hibernate.multi_tenant_connection_provider=dev.oasis.stockify.config.tenant.PostgreSQLMultiTenantConnectionProvider

# Hibernate Naming Strategy Configuration - PostgreSQL Multi-tenant Optimized
spring.jpa.hibernate.naming.implicit-strategy=org.hibernate.boot.model.naming.ImplicitNamingStrategyLegacyJpaImpl

# PostgreSQL-specific Physical Naming Strategy (Primary Solution)
spring.jpa.properties.hibernate.physical_naming_strategy=dev.oasis.stockify.config.tenant.PostgreSQLMultiTenantPhysicalNamingStrategy

# PostgreSQL specific settings for schema-based multi-tenancy
spring.jpa.properties.hibernate.default_schema=public
spring.jpa.properties.hibernate.globally_quoted_identifiers=false
spring.jpa.properties.hibernate.auto_quote_keyword=false
spring.jpa.open-in-view=false
spring.jpa.properties.hibernate.connection.provider_disables_autocommit=true

# Flyway Configuration for Multi-tenant Schema Migration
spring.flyway.enabled=${SPRING_FLYWAY_ENABLED:false}
spring.flyway.locations=classpath:db/migration
spring.flyway.schemas=public,com,rezonans
spring.flyway.default-schema=public
spring.flyway.create-schemas=true
spring.flyway.baseline-on-migrate=${SPRING_FLYWAY_BASELINE_ON_MIGRATE:true}
spring.flyway.validate-on-migrate=${SPRING_FLYWAY_VALIDATE_ON_MIGRATE:true}
spring.flyway.out-of-order=true
spring.flyway.baseline-version=0
spring.flyway.clean-disabled=false

# Thymeleaf Configuration - Production
spring.thymeleaf.enabled=true
spring.thymeleaf.encoding=UTF-8
spring.thymeleaf.cache=true

# Logging Configuration - Production
logging.level.root=WARN
logging.level.dev.oasis.stockify=INFO
logging.level.org.springframework.security=WARN
logging.level.org.hibernate.SQL=WARN
logging.level.org.hibernate.type.descriptor.sql.BasicBinder=WARN
logging.file.name=${LOG_FILE_PATH:logs/stockify-prod.log}
logging.file.max-size=100MB
logging.file.max-history=90
logging.pattern.file=%d{yyyy-MM-dd HH:mm:ss} [%thread] [tenant:%X{tenantId}] %-5level %logger{36} - %msg%n
logging.pattern.console=%d{yyyy-MM-dd HH:mm:ss} [%thread] [tenant:%X{tenantId}] %-5level %logger{36} - %msg%n

# Email Configuration - Disabled
notification.email.enabled=false
spring.mail.host=${MAIL_HOST:}
spring.mail.port=${MAIL_PORT:}
spring.mail.username=${MAIL_USERNAME:}
spring.mail.password=${MAIL_PASSWORD:}
spring.mail.properties.mail.smtp.auth=false
spring.mail.properties.mail.smtp.starttls.enable=false
spring.mail.properties.mail.smtp.starttls.required=false
spring.mail.properties.mail.smtp.ssl.trust=${MAIL_HOST:}

# Server Configuration
server.compression.enabled=true
server.compression.mime-types=text/html,text/xml,text/plain,text/css,text/javascript,application/javascript,application/json
server.compression.min-response-size=1024

# Security Configuration - Production
spring.security.require-ssl=${REQUIRE_SSL:true}
server.servlet.session.timeout=${SESSION_TIMEOUT:30m}
server.servlet.session.cookie.secure=${COOKIE_SECURE:true}
server.servlet.session.cookie.http-only=true
server.servlet.session.cookie.same-site=strict

# Actuator Configuration - Production
management.endpoints.web.exposure.include=health,metrics,prometheus
management.endpoint.health.show-details=never
management.endpoints.web.base-path=/actuator
management.endpoint.health.show-components=never
management.endpoint.health.probes.enabled=true
management.health.db.enabled=true
management.health.defaults.enabled=true
management.endpoint.health.roles=ADMIN
management.security.enabled=true

# Disable mail health indicator
management.health.mail.enabled=false

# Metrics and Monitoring
management.endpoint.metrics.enabled=true
management.endpoint.prometheus.enabled=true
management.metrics.tags.application=stockify
management.metrics.tags.environment=production
management.metrics.export.prometheus.enabled=true

# Performance and Caching - Production
spring.cache.type=caffeine
spring.cache.caffeine.spec=maximumSize=10000,expireAfterWrite=60m

# Error Handling - Production
server.error.whitelabel.enabled=false
server.error.include-stacktrace=never
server.error.include-message=on_param
